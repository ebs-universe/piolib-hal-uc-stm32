<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ebs-hal-uc-stm32: hal_platform/h7rsxx/core_impl.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">ebs-hal-uc-stm32<span id="projectnumber">&#160;0.2.4</span>
   </div>
   <div id="projectbrief">EBS uC HAL implementation for ST STM32 uCs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('h7rsxx_2core__impl_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">core_impl.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;hal/uc/core.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for core_impl.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="h7rsxx_2core__impl_8h__incl.svg" width="164" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="h7rsxx_2core__impl_8h__dep__incl.svg" width="164" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="h7rsxx_2core__impl_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a643f3959154a987076440534ccd59665" id="r_a643f3959154a987076440534ccd59665"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="h7rsxx_2core__impl_8h.html#a643f3959154a987076440534ccd59665">mpu_init</a> (void)</td></tr>
<tr class="memdesc:a643f3959154a987076440534ccd59665"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize MPU to sane defaults.  <br /></td></tr>
<tr class="separator:a643f3959154a987076440534ccd59665"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d6fdab6b0091a54a4bec25323e4eabf" id="r_a5d6fdab6b0091a54a4bec25323e4eabf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="h7rsxx_2core__impl_8h.html#a5d6fdab6b0091a54a4bec25323e4eabf">configure_memory_layout</a> (void)</td></tr>
<tr class="memdesc:a5d6fdab6b0091a54a4bec25323e4eabf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize Memory to sane defaults.  <br /></td></tr>
<tr class="separator:a5d6fdab6b0091a54a4bec25323e4eabf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a560ad8614ae03841a10b489f4370bc51" id="r_a560ad8614ae03841a10b489f4370bc51"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="h7rsxx_2core__impl_8h.html#a560ad8614ae03841a10b489f4370bc51">cpu_init</a> (void)</td></tr>
<tr class="memdesc:a560ad8614ae03841a10b489f4370bc51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize CPU features to sane defaults.  <br /></td></tr>
<tr class="separator:a560ad8614ae03841a10b489f4370bc51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9343b8537a5db2e3b0f97f33f77707c" id="r_af9343b8537a5db2e3b0f97f33f77707c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="h7rsxx_2core__impl_8h.html#af9343b8537a5db2e3b0f97f33f77707c">nvic_init</a> (void)</td></tr>
<tr class="separator:af9343b8537a5db2e3b0f97f33f77707c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5d6fdab6b0091a54a4bec25323e4eabf" name="a5d6fdab6b0091a54a4bec25323e4eabf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d6fdab6b0091a54a4bec25323e4eabf">&#9670;&#160;</a></span>configure_memory_layout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void configure_memory_layout </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize Memory to sane defaults. </p>
<p>Memory layout is technically application dependent. The function implemented here is a weak default placeholder which can be used if the application does not care.</p>
<p>These defaults presently assume a boot-only application, with fixed ITCM and DTCM sizes for 64KB and 128KB respectively. We also specify I2C instead of I3C (not sure of context) and disable ECC on SRAM.</p>
<p>Share of memory (RAM and Flash) provided for DTCM, ITCM is technically user configurable. However, since this also requires multiple changes in the linker file, we do not provide this control. This may be revisited in the future, since the linker file is kept in the application and can in principle be edited without editing the reusable ebs hal library.</p>
<p>This is associated with the STM32 FLASH peripheral, and the implementation here is generated using CubeMX and copied from flash.c </p>

</div>
</div>
<a id="a560ad8614ae03841a10b489f4370bc51" name="a560ad8614ae03841a10b489f4370bc51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a560ad8614ae03841a10b489f4370bc51">&#9670;&#160;</a></span>cpu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cpu_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize CPU features to sane defaults. </p>
<p>This function configures some core CPU features. Most of these features can be controlled by defines in application.h. It is <br  />
 implemented here as a weak default placeholder which can be overridden by the application if necessary, though this should not generally be required.</p>
<p>Enabling Data Cache requires certain variables to be forced into memory that is not cached, so that they can be used freely from ISRs without dealing with cache coherence / invalidation. An 'easy' way to achieve this is to put these variables into the DTCM.</p>
<p>Negative consequences of using the Instruction Cache are not presently known.</p>
<p>Both caches disabled, as well as disabling Speculative Execution, is the safest (and slowest) combination.</p>
<p>Enabling Speculative Exection is presently not implemented. It will need to be done in the ebs hal core peripheral. Specifically, the mpu_init function will need to be modified to enable execution on memory regions which should allow speculative execution. </p>

</div>
</div>
<a id="a643f3959154a987076440534ccd59665" name="a643f3959154a987076440534ccd59665"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a643f3959154a987076440534ccd59665">&#9670;&#160;</a></span>mpu_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mpu_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize MPU to sane defaults. </p>
<p>These defaults presently assume a boot-only application, with fixed ITCM and DTCM sizes for 64KB and 128KB respectively.</p>
<p>We use the default set by CubeMX and fallback to the default memory map. It is expected that this will prevent most instances of crashes due to speculative execution, since the present implementation more or less disables all speculative execution.</p>
<p>This configuration likely needs additional work before it is reliable. See : <a href="https://youtu.be/6IUfxSAFhlw">https://youtu.be/6IUfxSAFhlw</a>.</p>
<p>Various parameters related to memory regions are technically application dependent. The function implemented here is a weak default placeholder which can be used if the application does not care. </p>

</div>
</div>
<a id="af9343b8537a5db2e3b0f97f33f77707c" name="af9343b8537a5db2e3b0f97f33f77707c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9343b8537a5db2e3b0f97f33f77707c">&#9670;&#160;</a></span>nvic_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nvic_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the core interrupt controller. This does tend to be somewhat application specific, so it is implemented here as a weak default placeholder which can be overridden by the application if necessary, though this should not generally be required.</p>
<p>On this platform, initializes the NVIC Priority Grouping to 2, ie,</p>
<p>Sets priorities to 2 bits of Preemptible and 2 bits of Subpriority. This approach should probably work for most Cortex M processors.</p>
<p>Note that while this grouping is not generally relied on, we do not impose any explicit standards on how HAL implementations of libraries might use the interrupts. Changing it might break other HAL code or EBS libraries which expect this priority grouping. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_7da9fa3e46f3496e22e0d53e72e5a458.html">hal_platform</a></li><li class="navelem"><a class="el" href="dir_ecba37078b2646ad8615f0f92eab48bb.html">h7rsxx</a></li><li class="navelem"><a class="el" href="h7rsxx_2core__impl_8h.html">core_impl.h</a></li>
    <li class="footer">Generated on Sun Jan 12 2025 13:31:34 for ebs-hal-uc-stm32 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
